<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>タイトル</title>
  <meta name="keywords" content="ページのキーワードA,B,C">
  <meta name="description" content="ページの説明">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">

<style>
	aside {
		width: 250px;
		position: fixed; 
    		top: 0;
    		left: 0;
    		height: 100%; 
    		background-color: #C3D5C7;
    		padding: 15px;
    		box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
	}
	body {
		margin: 0;
  		padding: 0;
  		font-family: Arial, sans-serif;
  		background-color: #f9f9f9; 
		line-height: 1.5;
	}
	#content {
		max-width: 750px; 
    		margin: 0 auto; 
    		padding: 30px;
		background-color: #ffffff;
		box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
  		border-radius: 8px;
	}
	img {
		max-width: 80%; /* 親要素に収まるように制限 */
      		height: auto;    /* アスペクト比を保つ */
      		display: block;  /* インライン要素を解除 */
      		margin: 0 auto;  /* 中央揃え */
	}
	.example1 {
		max-width: 100%; /* 親要素に収まるように制限 */
		height: auto;    /* アスペクト比を保つ */
		display: block;  /* インライン要素を解除 */
		margin: 0 auto;  /* 中央揃え */
	}
	code, pre {
		font-size: 16px; /* フォントサイズを16ptに設定 */
		font-family: Consolas, "Courier New", monospace; /* 等幅フォントを指定 */
      		background-color: #f5f5f5; /* 背景色を薄い灰色に設定 */
      		color: #333; /* フォント色 */
      		padding: 10px; /* 内側の余白を追加 */
      		border-radius: 5px; /* 角を丸める */
      		display: block; /* ブロック要素として表示 */
      		overflow-x: auto; /* 横スクロールを有効化 */
      		line-height: 1.5; /* 行間を広げる */
	}
	.spaced-br {
		display: block; /* ブロック要素に変換 */
		margin-bottom: 16px; /* 行間を調整 */
	}
	.center-text {
		text-align: center;
		margin: 20px 0;
	}
	br {
		display: block; /* ブロック要素化 */
		margin-bottom: 24px; /* 下の余白を20pxに設定 */
	}
	ul {
		padding-left: 20px;
		margin-bottom: 20px;
	}
	ul li {
		margin-bottom: 15px;
		line-height: 1.8;
		font-size: 18px;
	}
	ul li br + span {
		font-size: 16px;
		color: #555;
	}
	.link ul {
		list-style: none;
    		padding: 0;
	}
	.link ul li {
    		margin: 10px 0;
	}
  	.link ul li a {
		text-decoration: none;
		color: #333;
	}
  	.link ul li a:hover {
    		color: #007BFF; 
	}
	p {
		font-size: 16px;
		line-height: 1.6;
	}
	h3 {
		font-size: 18px;
		margin-top: 20px;
	}
	h2 {
      		font-size: 24px;
      		margin-top: 20px;
	}
	header h1 {
      		font-size: 28px;
      		margin: 20px 0;
      		text-align: center;
	}
	header p {
      		text-align: center;
      		font-size: 14px;
      		color: #666;
	}
</style>

</head>
	<body>
		<div id="outer">
			<header>
				<div id="header-container"><div id="head-inner">
					<h1>自作pcでいろいろやった</h1>
					<p class="description">東北大学大学院生命科学研究科　渡邊峰</p></div></div>
			</header>
			<aside>
				<div class="left-title"><a href="index.html">トップページ</div>
				<div class="link">
					<ul>
						<li><a href="pc_enviroment.html">pcのスペックおよび作業環境</a></li>
						<li><a href="dual_boot.html">デュアルブートにしてみた</a></li>
						<li><a href="#section3">サーバーを構築してみた</a></li>
						<li><a href="GUI_error_1.html">GUIエラーの対処 (前編)</a></li>
						<li><a href="GUI_error_2.html">GUIエラーの対処 (後編)</a></li>
					</ul>
				</div>
			</aside>
			<div id="content">
				<main>
					<div id="inner">
						<h2>ここまでの流れ</h2>
						<p>PCを操作していたら固まったので、強制再起動した．
							<br>ふだん通りUbuntuでユーザーを選択，パスワードを入力した．
							<br>いつもならここでデスクトプ画面が表示されるが，真っ暗のまま何も表示されない．
							<br>起動→OS選択→ユーザー選択までは問題なさそうだが，GUI (Graphical User Interface)に関わるどこかで不具合が起きている？
							<br>システム再起動、X window system再起動
							<br>デスクトップ環境(gdm) に問題があるかを確認した
							いずれの手順でも原因はわからなかった。
						</p>
						<img src="images/GUI_trouble/comp_mechanism.png">
						<a href="https://hrzine.jp/article/detail/37" target="_blank">https://hrzine.jp/article/detail/37</a>
						<P>
							ここからはデスクトップ環境やXサーバーを含む、X window systemについて異常があるか確認する
							<br>X window systemの概要は以下の図
						</P>
						<img src="images/GUI_trouble/comp_mechanism_2.png">
						<a href="https://www.kenschool.jp/blog/?p=3349" target="_blank">https://www.kenschool.jp/blog/?p=3349</a>

						
						<h4>GNOMEシェルの再起動を試す </h4>
						<code>
							export DISPLAY=:0        # 環境変数DISPLAYの設定 
							<br>gnome-shell –replace     # 再起動
						</code>
						<p>
							GUIの起動にはXサーバーとデスクトップ環境との通信が必要になるので接続先を明示する必要がある
							<br>(ホスト名):(ディスプレイ番号).(スクリーン番号) のように指定。
							<br>リモート接続のときにはホストを指定する必要がるが、今回は指定しなくてもOK
						</p>
						<img src="images/GUI_trouble/gnome.jpg"class="example1">
						<code>
							Failed to setup: unable to open display '0' 
						</code>
						<p>
							XサーバーとXクライアント（デスクトップ環境）の通信がうまくいっていないor出力先のディスプレイを認識できていない 
							<br>出力先ディスプレイは先程DISPLAY変数で設定したので、一旦Xサーバーを再起動して様子を見る 
						</p>
						<h4>Xサーバーの再起動 </h4>
						<code>
							startx
						</code>
						<img src="images/GUI_trouble/startx.jpg"class="example1">
						<code>
							(II) Server terminated successfully (0). Closing log file. 
						</code>
						<p>
							Xサーバーの起動は問題なさそう。
							<br>ということは、デスクトップ環境との接続に問題がある？ 
						</p>

						<h4>.xinitrcを編集（Xサーバー起動時に実行されるスクリプト） </h4>
						<p>
							nanoエディタで起動して以下を書き込む
						</p>
						<code>
							exec gnome-session 
						</code>
						<p>
							startx実行時にGNOMEセッションを起動するように設定
							もう一度Xサーバーを再起動
						</p>
						<code>
							startx
						</code>
						<p>
							<b>無事にデスクトップが復活した！</b>
							<br>原因は結局よくわからなかったけど、固まってから強制電源オフしたときに.xinitrcが破損した？
							<br>またはグラボの挙動が不安定だったのでそれが原因？
							<br>結局よくわからずじまいなので、根本的解決にはなっていない気がする...
							
						</p>
						
						<h4>感想</h4>
						<p>
							理解したとは到底言い難いけれど、コンピューターの起動メカニズムの概念に触れることができた。 
							<br>仮想コンソールで日本語が文字化けするのは困るので22.04にアップデートするタイミングあたりで英語版を入れる
							<br>これからは固まっても強制電源オフせず、落ち着いて仮想コンソールに入る
						</p>
						<h4>参考記事</h4>
						<p>
							<a href="https://www.ep.sci.hokudai.ac.jp/~inex/y2017/0630/practical/01_x.html" target="_blank">https://www.ep.sci.hokudai.ac.jp/~inex/y2017/0630/practical/01_x.html</a>
							<a href="https://qiita.com/kakkie/items/c6ccce13ce0beaefaad1" target="_blank">https://qiita.com/kakkie/items/c6ccce13ce0beaefaad1</a>
							<br>chatGPT</p>
					</div>
				
			</div>
		</div>
	</body>
</html>
